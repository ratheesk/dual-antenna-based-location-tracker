<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triangulation Distance Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        input:focus {
            border-color: #4CAF50;
            outline: none;
        }

        button {
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        canvas {
            border: 2px solid #333;
            background-color: #fff;
        }

        .results {
            background-color: #e8f5e8;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }

        .results h3 {
            margin-top: 0;
            color: #2e7d32;
        }

        .distance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .distance-item {
            background: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .distance-value {
            font-size: 20px;
            font-weight: bold;
            color: #2e7d32;
        }

        .distance-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f44336;
            margin-top: 20px;
        }

        .info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <h1>Triangulation Distance Calculator</h1>

    <div class="container">
        <div class="info">
            <strong>How it works:</strong> Place two receivers at known positions, measure the angle to the signal
            source from each receiver, and calculate the exact location and distances.
        </div>

        <div class="input-section">
            <div class="input-group">
                <label for="baselineDistance">Baseline Distance (meters)</label>
                <input type="number" id="baselineDistance" value="10" step="0.1" min="0.1">
            </div>
            <div class="input-group">
                <label for="angle1">Angle from Receiver 1 (degrees)</label>
                <input type="number" id="angle1" value="45" step="1" min="0" max="180">
            </div>
            <div class="input-group">
                <label for="angle2">Angle from Receiver 2 (degrees)</label>
                <input type="number" id="angle2" value="60" step="1" min="0" max="180">
            </div>
            <div class="input-group">
                <button onclick="calculate()" style="margin-top: 25px;">Calculate Position</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="canvas-container">
            <canvas id="triangleCanvas" width="800" height="600"></canvas>
        </div>
    </div>

    <div class="container">
        <div id="results"></div>
    </div>

    <script>
        function calculate() {
            const d = parseFloat(document.getElementById('baselineDistance').value);
            const angle1 = parseFloat(document.getElementById('angle1').value);
            const angle2 = parseFloat(document.getElementById('angle2').value);

            // Validation
            if (isNaN(d) || isNaN(angle1) || isNaN(angle2)) {
                showError('Please enter valid numbers for all fields.');
                return;
            }

            if (d <= 0) {
                showError('Baseline distance must be greater than 0.');
                return;
            }

            if (angle1 < 0 || angle1 > 180 || angle2 < 0 || angle2 > 180) {
                showError('Angles must be between 0 and 180 degrees.');
                return;
            }

            // Calculate using triangulation
            const result = triangulate(d, angle1, angle2);

            if (result.error) {
                showError(result.error);
                return;
            }

            // Draw the triangle
            drawTriangle(d, angle1, angle2, result);

            // Show results
            showResults(result);
        }

        function triangulate(d, angle1Deg, angle2Deg) {
            const theta1 = angle1Deg * Math.PI / 180;
            const theta2 = Math.PI - (angle2Deg * Math.PI / 180);

            const sin_diff = Math.sin(theta1 - theta2);
            if (Math.abs(sin_diff) < 1e-10) {
                return { error: 'Lines are parallel and do not intersect.' };
            }

            const sin1 = Math.sin(theta1);
            const cos1 = Math.cos(theta1);
            const sin2 = Math.sin(theta2);
            const cos2 = Math.cos(theta2);

            const t = -d * sin2 / sin_diff;
            const s = -d * sin1 / sin_diff;

            const distance1 = Math.abs(t);
            const distance2 = Math.abs(s);

            if (distance1 === 0 || distance2 === 0) {
                return { error: 'Source coincides with a receiver.' };
            }

            const sourceX = t * cos1;
            const sourceY = t * sin1;

            // Compute actual interior angles
            let angle1_actual = (180 / Math.PI) * Math.acos(sourceX / distance1);
            let angle2_actual = (180 / Math.PI) * Math.acos((d - sourceX) / distance2);

            const dot3 = -d * sourceX + distance1 * distance1;
            const cos3 = dot3 / (distance1 * distance2);
            let angle3_actual = (180 / Math.PI) * Math.acos(cos3);

            if (isNaN(angle1_actual) || isNaN(angle2_actual) || isNaN(angle3_actual) || !isFinite(t) || !isFinite(s)) {
                return { error: 'Invalid configuration.' };
            }

            return {
                distance1: distance1,
                distance2: distance2,
                baseline: d,
                sourceX: sourceX,
                sourceY: sourceY,
                angle1: angle1_actual,
                angle2: angle2_actual,
                angle3: angle3_actual
            };
        }

        function drawTriangle(d, angle1, angle2, result) {
            const canvas = document.getElementById('triangleCanvas');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Compute scale dynamically
            const absY = Math.abs(result.sourceY);
            const maxHorizontal = Math.max(Math.abs(result.sourceX), Math.abs(result.sourceX - d));
            const viewWidth = Math.max(d, 2 * maxHorizontal);
            const viewHeight = 2 * absY;
            let scale = Math.min(
                (canvas.width * 0.8) / (viewWidth || 1),
                (canvas.height * 0.8) / (viewHeight || 1)
            );

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Calculate positions (shifted relative to center)
            const receiver1X = centerX - (d * scale) / 2;
            const receiver1Y = centerY;
            const receiver2X = centerX + (d * scale) / 2;
            const receiver2Y = centerY;
            const sourceX_draw = receiver1X + result.sourceX * scale;
            const sourceY_draw = receiver1Y - result.sourceY * scale; // Note: canvas Y is downward

            // Draw grid
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i < canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }

            // Draw triangle
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(receiver1X, receiver1Y);
            ctx.lineTo(sourceX_draw, sourceY_draw);
            ctx.lineTo(receiver2X, receiver2Y);
            ctx.lineTo(receiver1X, receiver1Y);
            ctx.stroke();

            // Draw baseline
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(receiver1X, receiver1Y);
            ctx.lineTo(receiver2X, receiver2Y);
            ctx.stroke();

            // Draw angle arcs
            drawAngleArc(ctx, receiver1X, receiver1Y, sourceX_draw, sourceY_draw, receiver2X, receiver2Y, result.angle1, '#FF5722', 'right');
            drawAngleArc(ctx, receiver2X, receiver2Y, sourceX_draw, sourceY_draw, receiver1X, receiver1Y, result.angle2, '#2196F3', 'left');

            // Draw points
            drawPoint(ctx, receiver1X, receiver1Y, 'Receiver 1', '#4CAF50');
            drawPoint(ctx, receiver2X, receiver2Y, 'Receiver 2', '#4CAF50');
            drawPoint(ctx, sourceX_draw, sourceY_draw, 'Signal Source', '#f44336');

            // Draw distance labels
            drawDistanceLabel(ctx, receiver1X, receiver1Y, sourceX_draw, sourceY_draw, result.distance1.toFixed(2) + 'm');
            drawDistanceLabel(ctx, receiver2X, receiver2Y, sourceX_draw, sourceY_draw, result.distance2.toFixed(2) + 'm');
            drawDistanceLabel(ctx, receiver1X, receiver1Y, receiver2X, receiver2Y, d.toFixed(2) + 'm');
        }

        function drawPoint(ctx, x, y, label, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(label, x, y - 15);
        }

        function drawDistanceLabel(ctx, x1, y1, x2, y2, text) {
            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2;

            ctx.fillStyle = '#fff';
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.fillRect(midX - 25, midY - 10, 50, 20);
            ctx.strokeRect(midX - 25, midY - 10, 50, 20);

            ctx.fillStyle = '#000';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(text, midX, midY + 4);
        }

        function drawAngleArc(ctx, centerX, centerY, point1X, point1Y, point2X, point2Y, angle, color, side) {
            const radius = 40;

            // Calculate angles
            const angle1 = Math.atan2(point1Y - centerY, point1X - centerX);
            const angle2 = Math.atan2(point2Y - centerY, point2X - centerX);

            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, angle2, angle1, side === 'left');
            ctx.stroke();

            // Add angle label
            const labelAngle = (angle1 + angle2) / 2;
            const labelX = centerX + Math.cos(labelAngle) * (radius + 15);
            const labelY = centerY + Math.sin(labelAngle) * (radius + 15);

            ctx.fillStyle = color;
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(angle.toFixed(1) + '°', labelX, labelY);
        }

        function showResults(result) {
            const resultsDiv = document.getElementById('results');

            const html = `
                <div class="results">
                    <h3>Triangulation Results</h3>
                    <div class="distance-grid">
                        <div class="distance-item">
                            <div class="distance-value">${result.distance1.toFixed(2)} m</div>
                            <div class="distance-label">Distance from Receiver 1</div>
                        </div>
                        <div class="distance-item">
                            <div class="distance-value">${result.distance2.toFixed(2)} m</div>
                            <div class="distance-label">Distance from Receiver 2</div>
                        </div>
                        <div class="distance-item">
                            <div class="distance-value">${result.baseline.toFixed(2)} m</div>
                            <div class="distance-label">Baseline Distance</div>
                        </div>
                        <div class="distance-item">
                            <div class="distance-value">${result.angle3.toFixed(1)}°</div>
                            <div class="distance-label">Angle at Source</div>
                        </div>
                        <div class="distance-item">
                            <div class="distance-value">(${result.sourceX.toFixed(2)}, ${result.sourceY.toFixed(2)})</div>
                            <div class="distance-label">Source Coordinates</div>
                        </div>
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<div class="error"><strong>Error:</strong> ${message}</div>`;
        }

        // Initialize with default calculation
        window.onload = function () {
            calculate();
        };
    </script>
</body>

</html>